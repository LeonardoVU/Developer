var mn =
{
    Start_Inicio_Click: {
        0: {},
        English: {
            0: {},
            Products_and_Services: {
                0: {},
                General: {
                    0: {},
                    1: "Engineering\nDesign\nData",
                    2: "Project\nEngineering\nPlan",
                    3: "Project\nEquipment\nList",
                    4: "Engineering\nDocument\nRegister"
                },
                Process: {
                    0: {},
                    1: "Process\ndescription\nand\noperating\nphilosophy",
                    2: "General\nspecification\nfor valves",
                    3: "Process\nEquipment\nlist",
                    4: "Heat and\nmaterial\nbalance",
                    5: "Utility\nconsumption\nlist",
                    6: "Equipment\nprocess\ndata sheets",
                    7: "Piping and\nInstrumentation\nDiagrams\n(P&IDs)",
                    8: "Cause and\neffect\ndiagrams",
                    9: "Emergency\nshutdown\nblock\ndiagram",
                    10: "ESD logic\ndiagrams",
                    11: "Flare\nReport",
                    12: "Process\nfluids\nlist",
                    13: "Calculations\nnotes",
                    14: "Operating\nmanual"

                },
                Equipment: {
                    0: {},
                    1: "General\nspecification\nper\nequipment\ntype",
                    2: "Pressure\nVessels\nDesign\nSpecification",
                    3: "Equipment\nsupply\nspecification",
                    4: "Mechanical\ndata\nsheet",
                    5: "Heat\nexchanger\ncalculation\nsheet",
                    6: "Vessel\nguide\ndrawing",
                    7: "Material\nrequisition",
                    8: "Technical\nbid\nevaluation"
                },
                HSE: {
                    0: {}
                },
                Civil: {
                    0: {},
                    1: "Design\nspecification\n/ Basis of\ndesign",
                    2: "Grading\nplan",
                    3: "Foundation\ncalculation\nnote",
                    4: "Foundation\ndrawing:\nReinforcement",
                    5: "Foundation\ndrawing:\nFormwork",
                    6: "Civil works\nspecification",
                    7: "Standard\ndrawinqs",
                    8: "Drainage\ncalculation\nnote",
                    9: "General\nUnderground\nNetworks\ndrawing",
                    10: "Civil\nworks\ninstallation\ndrawings",
                    11: "Architectural\ndrawings",
                    12: "Building\ndetail\ndrawings",
                    13: "Steel\nStructure\nCalculation\nnote",
                    14: "Steel\nstructure\ndesign\ndrawings",
                    15: "Civil\nMaterial\nTake-Off\n(MTO)",
                    16: "Steel\nstructure\nstandard\ndrawings"
                },
                Plant_Layout: {
                    0: {},
                    1: "Plant Layout\nDesign\nspecification\n/ Plant layout\nguidelines",
                    2: "General\nPlot Plan\ndrawing",
                    3: "Key plan",
                    4: "Unit\nPlot Plan\ndrawing"
                },
                Piping_Design: {
                    0: {},
                    1: "Piping\nDesign\nBasis",
                    2: "Line\ndiagrams",
                    3: "Piping\nlayout\ndrawings",
                    4: "Piping\ngeneral\narrangement\ndrawings",
                    5: "Piping\nisometric\ndrawings",
                    6: "Line\nlist",
                    7: "Piping\nMaterial\nTake-Off"
                },
                Piping_Material: {
                    0: {},
                    1: "General\npiping\nspecification",
                    2: "General\nspecification\nfor\nvalves",
                    3: "Piping\nmaterial\nclasses\nspecifications",
                    4: "Job\nSpecifications\nfor\nSupply",
                    5: "Piping\nMaterial\nRequisition"
                },
                Piping_Stress_Analysis: {
                    0: {},
                    1: "Piping\nflexibility\nand stress\nanalysis\ncriteria",
                    2: "Piping\nstress\nanalysis\nCalculation\nnote",
                    3: "Pipe\nsupport\nbooklet",
                    4: "Job\nSpecifications\nfor\nSupply",
                    5: "Pipe\nsupport\ndrawings"
                },
                Material_and_Corrosion: {
                    0: {},
                    1: "Corrosion\ncontrol and\nmaterial\nselection\nreport",
                    2: "Material\nselection\ndiagrams",
                    3: "Cathodic\nprotection\nsystem\ndesign\nspecification",
                    4: "Painting\nspecification",
                    5: "Insulation\nspecification",
                    6: "Insulation\nmaterial\ntake-off"
                },
                Instruments_and_Control: {
                    0: {},
                    1: "System\nDesiqn\nSpecification\n/Desiqn basis\n/Philosophy",
                    2: "System\narchitecture\ndrawing",
                    3: "Instrument\nfunctional\ndiagram",
                    4: "Control\nnarrative",
                    5: "Mimic\ndisplay\ndrawings",
                    6: "Safety\nIntegrity\nLevel (SIL)\nreview",
                    7: "Instrument\nindex",
                    8: "Instrument\ndata\nsheets",
                    9: "Level\nsketches",
                    10: "Main cable\nroutings and\nJunction Box\n(JB) location\ndrawings",
                    11: "Instrument\nlocation &\nsecondary\ncable routing\ndrawings",
                    12: "Cable\nrouting\ndrawings",
                    13: "Cable\ncross\nsection\ndrawings",
                    14: "Cable\nlist",
                    15: "Instrument\nbulk material\ntake-off",
                    16: "Junction\nbox\nwiring",
                    17: "Typical\ninstallation\ndrawings",
                    18: "Equipment\nlayout\ndrawings",
                    19: "Telecom.\nsystems\ndesign\nspecification",
                    20: "Telecom.\nequipment\nlayout\ndrawing",
                    21: "Instrument\nloop\ndiagrams"
                },
                Electricity: {
                    0: {},
                    1: "Electrical\ndesign\nspecification",
                    2: "Electrical\nconsumer\nlist",
                    3: "Electrical\nload\nsummary",
                    4: "General\none line\ndiagram",
                    5: "Equipment\ndata\nsheet",
                    6: "General\nequipment\nspecification",
                    7: "Equipment\nrequisition",
                    8: "Switchgear\nsingle line\ndiagram",
                    9: "Switchgear\ntypical\ndiagram",
                    10: "Architecture\ndrawing",
                    11: "Equipment\nlayout\ndrawings",
                    12: "Lighting\nlayout\ndrawings",
                    13: "Cable\nrouting\ndrawings",
                    14: "Cable list",
                    15: "Typical\ninstallation\ndrawings",
                    16: "Electrical bulk\nMaterial\nTake-Off\n(MTO)",
                    17: "Block\ndiagrams",
                    18: "Trouble\nshooting\ndiagrams",
                    19: "Electrical\ncalculations"
                }
            },
            Experience: {
                0: {},
                Mining: {
                    0: {},
                    1: "Under\nConstruction"
                },
                Oil_and_Gas: {
                    0: {},
                    1: "Under\nConstruction"
                },
                Power_Generation: {
                    0: {},

                    Up_to_100MW: {
                        0: {},
                        Grid_BackUp: {
                            0: {},
                            Open_Cycle_50MW: {
                                0: {},
                                1: "Location:\nZulia\nState,\nVenezuela",
                                2: "Company:\nPENTECH",
                                3: "Date:\n2011-2012",
                                4: "Role:\nPiping\nDesign\nLeader",
                                5: "Scope:\nBOP\nDesign",
                                6: "Qty:\n3 Units\nGE LM2500\n25 MW eu"
                            }
                        }
                    },
                    More_100MW: {
                        0: {},
                        New_Plants: {
                            0: {},
                            Open_Cycle_150MW: {
                                0: {},
                                1: "Location:\nCasanare\nDepartment,\nColombia",
                                2: "Company:\nSINCO-\nSOLUCIONES\nDE I&C",
                                3: "Date:\n2019-2020",
                                4: "Role:\nCivil\nDesigner\nx1",
                                5: "Scope:\nCivil\nDesign",
                                6: "Qty:\n3 Units\nGE LM6000\n50 MW eu"
                            },
                            Closed_Cycle_250MW: {
                                0: {},
                                1: "Location:\nBuenos Aires\nProvince,\nArgentina",
                                2: "Company:\nBarker\nThermoelectric",
                                3: "Date:\n2018-2019",
                                4: "Roles:\nSite Civil\nEngineer\nx1",
                                5: "Scope:\nSite Design\nModifications",
                                6: "Qty:\n4 Units\nGE LM6000\n50 MW eu"

                            },
                            Closed_Cycle_450MW: {
                                0: {},
                                1: "Location:\nZulia\nState,\nVenezuela",
                                2: "Company:\nJANTESA",
                                3: "Date:\n2009-2010",
                                4: "Roles:\nPiping\nDesign\nx3",
                                5: "Roles:\nElectrical\nDesign\nx1",
                                7: "Scope:\nBOP,\nElectrical\nDesign",
                                8: "Qty:\n2 Units\nSGT6-5000F\n150 MW eu"
                            }

                        }
                    },


                }
            },
            Contact: {
                0: {},
                Email: "email:\nljv004ar@\ngmail.com",
                Phone: "Phone:\n+541160423223"
            }

        },
        Spanish: {
            0: {},
            Productos_y_Servicios: {
                0: {},
                General: {
                    0: {},
                    1: "Levantamiento\n(Relevamiento)\nde Información\nde Ingeniería",
                    2: "Planificación\nde Proyectos\nde Ingeniería",
                    3: "Lista de\nEquipos de\nProyectos",
                    4: "Registro de\nDocumentos\nde Ingeniería"
                },
                Procesos: {
                    0: {},
                    1: "Descripción\nde Procesos y\nFilosofía\nde Operación",
                    2: "Especificaciones\ngenerales\npara\nválvulas",
                    3: "Lista de\nEquipos de\nProcesos",
                    4: "Balances\nde Energia\ny Materia",
                    5: "Lista de\nSistemas de\nServicios",
                    6: "Hojas de\nDatos de\nEquipos de\nProcesos",
                    7: "Diagramas\nde Tuberías\n(Cañerías) e\nInstrumentación\n(P&IDs)",
                    8: "Diagramas\nde Causa\ny Efecto",
                    9: "Diagramas\nde Bloque de\nParo de\nEmergencia",
                    10: "Diagranas\nde Lógica\nESD",
                    11: "Reporte\nde Flare",
                    12: "Lista de\nFluidos de\nProcesos",
                    13: "Notas de\nCálculo",
                    14: "Manuales de\nOperación"

                },
                Equipos: {
                    0: {},
                    1: "Especificaciones\nGenerales\npor tipo\nde Equipo",
                    2: "Especificación\nde Diseño\nde Recipientes\na Presión",
                    3: "Especifiación\nde Suministro\nde Equipos",
                    4: "Hojas de\nDatos de\nEquipos\nMecánicos",
                    5: "Hoja de\nCálculos de\nIntercambiadores\nde Calor",
                    6: "Planos\nGuía de\nRecipientes",
                    7: "Requisiones\nde\nMateriales",
                    8: "Evaluación\nTécnica de\nOfertas"
                },
                SHA: {
                    0: {}
                },
                Civil: {
                    0: {},
                    1: "Especificaciones\n/ Bases de\nDiseño",
                    2: "Planos de\nRelleno, Corte\ny Nivelación",
                    3: "Notas de\nCálculo de\nFundaciones",
                    4: "Planos de\nFundaciones:\nRefuerzos",
                    5: "Planos de\nFundaciones:\nEncofrado",
                    6: "Especificaciones\nde trabajos\nCiviles",
                    7: "Planos\nEstandar",
                    8: "Notas de\nCálculo de\nDrenajes",
                    9: "Planos\nGenerales\nde Redes\nSubterraneas",
                    10: "Planos de\nInstalación\nde Trabajos\nCiviles",
                    11: "Planos de\nArquitectura",
                    12: "Planos de\nDetalles de\nEdificaciones",
                    13: "Notas de\nCálculo de\nEstructuras\nde Acero",
                    14: "Planos de\nDiseño de\nEstructuras\nde Acero",
                    15: "Cuantificación\nde Materiales\nCiviles (MTO)",
                    16: "Planos\nEstandar de\nEstructuras\nde Acero"
                },
                Arreglo_de_Planta: {
                    0: {},
                    1: "Especificación\nde Diseño/\nLineamientos de\nDisposición de\nPlanta",
                    2: "Plano\nGeneral de\nDisposición\nde Planta",
                    3: "Plano\nLlave",
                    4: "Plano de\nDisposición\npor\nUnidad"
                },
                Diseño_de_Tuberías_Cañerias: {
                    0: {},
                    1: "Bases de\nDiseño de\nTuberías\n(Cañerías)",
                    2: "Diagramas\nde Línea",
                    3: "Planos de\nDisposición de\nTuberías\n(Cañerías)",
                    4: "Planos de\narreglos\ngenerales de\nTuberías\n(Cañerías)",
                    5: "Planos\nIsométricos de\nTuberías\n(Cañerías)",
                    6: "Lista de\nLíneas",
                    7: "Cuantificación\nde Materiales de\nTuberías\n(Cañerías)"
                },
                Materiales_de_Tuberías_Cañerias: {
                    0: {},
                    1: "Especificación\nGeneral de\nTuberías\n(Cañerías)",
                    2: "Especificación\nGeneral de\nVálvulas",
                    3: "Especificaciones\nde Clases de\nMaterial de\nTuberías\n(Cañerías)",
                    4: "Especificaciones\nde Trabajo para\nsuministro",
                    5: "Requisición de\nMateriales de\nTuberías\n(Cañerías)"
                },
                Análisis_de_Esfuerzos_en_Tuberías_Cañerias: {
                    0: {},
                    1: "Criterios de\nFlexibilidad y\nEsfuerzos en\nTuberías\n(Cañerías)",
                    2: "Notas de\nCálculo de\nanálisis de\nEsfuerzos en\nTuberías\n(Cañerías)",
                    3: "Cuaderno de\nsoportes de\nTuberías\n(Cañerías)",
                    4: "Especificaciones\nde Trabajo para\nsuministro",
                    5: "Planos de\nsoportes de\nTuberías\n(Cañerías)"
                },
                Materiales_y_Corrosión: {
                    0: {},
                    1: "Reporte de\nControl de\nCorrosión y\nselección de\nmateriales",
                    2: "Diagramas de\nselección de\nMateriales",
                    3: "Especificación\nde diseño\nde Sistemas\nde Protección\nCatódica",
                    4: "Especificación\nde Sistemas\nde Pintura y\nProtección\nMecánica",
                    5: "Especificación\nde Aislamiento\nTérmico",
                    6: "Cuantificación\nde materiales\nde aislamiento"
                },
                Instrumentación_y_Control: {
                    0: {},
                    1: "Especificación\nde Diseño /\nBases de\nDiseño /\nFilosofía\ndel Sistema",
                    2: "Planos de\nArquitectura\ndel Sistema",
                    3: "Diagrama\nfuncional de\nInstrumentos",
                    4: "Narrativa\nde Control",
                    5: "Planos de\ndespliegue\nde Mimicos",
                    6: "Revisión\nNivel de\nIntegridad\nde Seguridad\n(SIL)",
                    7: "Indice de\nInsrtumentos",
                    8: "Hojas de\nDatos de\nInstrumentos",
                    9: "Bosquejos\nde Nivel",
                    10: "Planos de\nrutas de cables\nprincipales y\nubicación de\nCajas de\nConexión (JB)",
                    11: "Planos de\nubicación de\nInstrumentos y\nruta de cables\nsecundarios",
                    12: "Planos de\nrutas de\ncables",
                    13: "Planos de\nsección\ntransversal\nde cables",
                    14: "Lista de\nCables",
                    15: "Cuantificación\nde Materiales\nde Instrumentos\na granel",
                    16: "Conexionado\nde Cajas de\nConexión (JB)",
                    17: "Planos típicos\nde instalación",
                    18: "Planos de\narreglo\nde Equipos",
                    19: "Especificaciones\nde diseño de\nsistemas de\ntelecom.",
                    20: "Planos de\ndisposición\nde equipos\nde telecom.",
                    21: "Diagramas\nde lazo de\nInstrumentos"
                },
                Electricidad: {
                    0: {},
                    1: "Especificación\nde diseño\nElectrica",
                    2: "Lista\nde consumo\nEléctrico",
                    3: "Totalización\nde Carga\nEléctrica",
                    4: "Diagrama\nunifilar\ngeneral",
                    5: "Hojas\nde datos\nde Equipos",
                    6: "Especificación\ngeneral\nde Equipos",
                    7: "Requisición\nde Equipos",
                    8: "Diagramas\nunifilares de\nInterruptores",
                    9: "Diagrama\ntípico de\nInterruptores",
                    10: "Plano de\nArquitectura",
                    11: "Planos de\ndisposición\nde Equipos",
                    12: "Planos de\ndisposición de\nIluminación",
                    13: "Planos de\nrutas\nde cables",
                    14: "Lista de\nCables",
                    15: "Planos\nTípicos de\ninstalación",
                    16: "Cuantificación\nde material\nElectrico a\ngranel (MTO)",
                    17: "Diagramas\nde Bloque",
                    18: "Diagramas\nde Resolución\nde Problemas\n(TroubleShooting)",
                    19: "Cálculos\nEléctricos"
                }/*  */
            },
            Experiencia: {
                0: {},
                1: "En\nConstruccion"
            },
            Contacto: {
                0: {},
                Email: "ljv004ar@\ngmail.com",
                Telefono: "Telefono:\n+541160423223"
            }
        }
    }
};

var PI = Math.PI;
var clk = -1;

var e = mn;
var en = [];
var mstxt = [];
var enlen = 0;
var dvc = 10;
var cz = dvc;
var ca = 3 * PI / 2;

var esc = 0.75;

const ua = navigator.userAgent;
if (/mobile/i.test(ua)) {
    dvc = 1.5;
    //return 'Mobile';
} else if (/tablet/i.test(ua)) {
    dvc = 1.5;
    //return 'Tablet';
} else {
    dvc = 10;
    //return 'Desktop';
}

var strt = [];
var crrt = [];
var dfrc = [];
var whr = 0;
var X = -300;
var Z = 600;
//(async function () {
/*     if (!navigator.gpu) {
        alert("Web GPU is not supported on your platform so far.");
        return;
    } */
const canvas = document.getElementById("Vue0");
//console.log(canvas.parentNode);
const engine = new BABYLON.Engine(canvas, true, { preserveDrawingBuffer: true, stencil: true, disableWebGL2Support: false });
//const engine = new BABYLON.WebGPUEngine(canvas);
//await engine.initAsync();
const createScene = async function () {


    const scene = new BABYLON.Scene(engine);

    var bldgs = [
        {
            name: "Productos y Servicios",
            loc: { x: 0 + X, y: 0, z: Z },
            strs: 50,
            clsn: 16,
            cld: { w: esc, d: esc, h: esc * 7 },
            strd: { w: 3 * esc * 150, d: 2 * esc * 150, h: esc / 3 },
            els: { w: esc * 40, d: esc * 20 },
            slM: 15000,
            slF: 1,
            clM: 500,
            clF: 1,
            bxs: [],
            bxsi: [],
            slxi: [],
            sttc: true,
            COT: new BABYLON.TransformNode(this.name)

        },
        {
            name: "Generales",
            loc: { x: 300 + X, y: 0, z: Z },
            strs: 20,
            clsn: 16,
            cld: { w: esc, d: esc, h: esc * 7 },
            strd: { w: esc * 150, d: esc * 150, h: esc / 3 },
            els: { w: esc * 40, d: esc * 20 },
            slM: 1500,
            slF: 1,
            clM: 150,
            clF: 1,
            bxs: [],
            bxsi: [],
            slxi: [],
            sttc: true,
            COT: new BABYLON.TransformNode(this.name)
        },
        {
            name: "Tercero",
            loc: { x: 500 + X, y: 0, z: Z },
            strs: 30,
            clsn: 8,
            cld: { w: esc, d: esc, h: esc * 7 },
            strd: { w: esc * 150, d: esc * 150, h: esc / 3 },
            els: { w: esc * 40, d: esc * 20 },
            slM: 10000,
            slF: 1,
            clM: 500,
            clF: 1,
            bxs: [],
            bxsi: [],
            slxi: [],
            sttc: true,
            COT: new BABYLON.TransformNode(this.name)
        },
        {
            name: "Cuarto",
            loc: { x: 800 + X, y: 0, z: Z },
            strs: 40,
            clsn: 8,
            cld: { w: esc, d: esc, h: esc * 7 },
            strd: { w: esc * 150, d: esc * 150, h: esc / 3 },
            els: { w: esc * 40, d: esc * 20 },
            slM: 1500,
            slF: 1,
            clM: 1500,
            clF: 1,
            bxs: [],
            bxsi: [],
            slxi: [],
            sttc: true,
            COT: new BABYLON.TransformNode(this.name)
        }
    ];

    //bldgs[0].test = new BABYLON.TransformNode(this.name);   Puede pasarse el arreglo de parametros y valores de los edificios para luego asignar los valores

    var camera = new BABYLON.ArcRotateCamera("camera", ca, 16 * PI / 32, cz, new BABYLON.Vector3(0, 5, 0), scene);

    //camera.attachControl(canvas, true);
    //camera.maxZ = 18000;
    camera.wheelDeltaPercentage = 0.01;

    var light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0.5, 0.5, -0.5), scene);
    light.position = new BABYLON.Vector3(-3500, 7000, 7000);
    light.intensity = 0.95;
    //camera.zoomToMouseLocation = true;

    var skyDome = new BABYLON.MeshBuilder.CreateSphere("Sky", { diameter: 18000, sideOrientation: 0 }, scene);

    var skyMaterial = new BABYLON.SkyMaterial("skyMaterial", scene);
    skyMaterial.backFaceCulling = false;
    skyDome.isPickable = false;

    skyDome.material = skyMaterial;
    skyMaterial.turbidity = 1;
    skyMaterial.luminance = 1;
    skyMaterial.inclination = 0.425;
    skyMaterial.azimuth = 0.375;
    //skyMaterial.useSunPosition = true;
    //skyMaterial.sunPosition = new BABYLON.Vector3(-3500, 7500, 7000);
    skyMaterial.rayleigh = 2;
    const ground = BABYLON.MeshBuilder.CreateGround("ground", { width: 18000, height: 18000, sideOrientation: BABYLON.Mesh.DOUBLESIDE }, scene);


    var wallMat = new BABYLON.StandardMaterial("myMaterial", scene);

    wallMat.diffuseColor = new BABYLON.Color3(0.1, 0.35, 0.5);

    ground.material = wallMat;


    var anchor = new BABYLON.TransformNode("");



    var manager = new BABYLON.GUI.GUI3DManager(scene);

    var panel = new BABYLON.GUI.StackPanel3D();
    if (this.outerWidth > this.outerHeight) {
        panel.isVertical = false;
    } else {
        panel.isVertical = true;
    }


    //panel.radius = 5;
    panel.margin = 0.10475;

    manager.addControl(panel);

    panel.position.y = 0;
    //panel._columns = 1;
    panel.linkToTransformNode(anchor);

    anchor.position.y = 5;

    var stxt = "";
    var addButton = function (txt, value) {

        var button = new BABYLON.GUI.HolographicButton("");
        panel.addControl(button);
        button.backgroundColor = "Black";
        //button.text.fontSize = 12;
        const text1 = new BABYLON.GUI.TextBlock();
        text1.color = "White";
        text1.fontSize = 32;
        if (typeof value === "object") {

            if (txt === "0") { txt = "Back"; }
            try {
                text1.text = txt.replace(/_/g, "\n");
                //text0.text = text1.text;
            }
            catch {
                text1.text = txt;
                //text0.text = text1.text;
            }

            //text1.text = txt;
            button.content = text1;
            //button.text = txt;
            button.onPointerUpObservable.add(function (txt) {
                //console.log(button.text);
                try {
                    stxt = text1.text.replace(/\n/g, "_");
                }
                catch {
                    stxt = text1.text;// = txt;
                }
                //stxt = text1.text;
                clk = 1;
                //camera.alpha = ca;
                return stxt;
            });
        } else {
            //button.text = value;

            text1.text = value;
        }
        button.content = text1;
        var btnCnt = button.content;
        //button.textWrapping = true;
        //btnCnt.color = "Red";
        btnCnt._scaleY = 1;
        button.content._scaleX = 1;
        //btnCnt._paddingTop.value=-125;
        //button.content._currentMeassure.height = 60;
        //button._clipContent=false;
        //btnCnt.height = 0.075;
        //console.log(button.content._height);


    }




    bldgs.forEach((bld) => {
        bld.bxs = [];
        bld.bxsi = [];
        dh = bld.strd.h / 2;
        var j = bldgs.indexOf(bld);
        //var ipnt = new BABYLON.Vector3(bld.loc.x, bld.loc.y + dh, bld.loc.z);
        var ipnt = new BABYLON.Vector3(0, dh, 0);



        for (i = 0; i < bld.strs; i++) {
            if (i === 0) {
                var slbOpts = {
                    width: bld.strd.w,
                    height: bld.strd.h,
                    depth: bld.strd.d,
                    sideOrientation: BABYLON.Mesh.DEFAULTSIDE
                };
                var slb = new BABYLON.MeshBuilder.CreateBox(j + ":" + i + "-F", slbOpts, scene);
                slb.position = ipnt;
                bld.bxs.push(slb);

            }
            var ccntr = 0;
            var clmx = 0;
            var clmz = 0;
            for (c = 0; c < bld.clsn; c++) {

                var cn = Math.trunc(c / 4) + 1;
                var clstp = 1 + 1 / 4 - (cn) / 4;
                //  console.log(j, c, cn, clstp, -clstp);

                //console.log(j, c, ccntr, cn, clstp, -clstp);

                switch (ccntr) {
                    case 0:
                        clmx = clstp;
                        clmz = clstp;
                        break;
                    case 1:
                        clmx = -clstp;
                        clmz = clstp;
                        break;
                    case 2:
                        clmx = -clstp;
                        clmz = -clstp;
                        break;
                    case 3:
                        clmx = clstp;
                        clmz = -clstp;
                        break;
                    default:
                        break;
                }
                //console.log(j, c, ccntr, cn, clmx, clmz);

                var colOpts = {
                    width: bld.cld.w,
                    height: bld.cld.h,
                    depth: bld.cld.d,
                    sideOrientation: BABYLON.Mesh.DEFAULTSIDE
                }

                if (c === 0) {
                    var col = new BABYLON.MeshBuilder.CreateBox(j + ":" + i + "-C" + c, colOpts, scene);
                    colRlx = clmx * (bld.strd.w / 2 - 2 * bld.cld.w);
                    colRlz = clmz * (bld.strd.d / 2 - 2 * bld.cld.d);
                    colRly = i * (bld.cld.h + bld.strd.h) + bld.cld.h / 2 + bld.strd.h / 2;
                    col.position = ipnt.add(new BABYLON.Vector3(colRlx, colRly, colRlz));


                } else {
                    var col = col.clone(j + ":" + i + "-C" + c);
                    colRlx = clmx * (bld.strd.w / 2 - 2 * bld.cld.w);
                    colRlz = clmz * (bld.strd.d / 2 - 2 * bld.cld.d);
                    colRly = i * (bld.cld.h + bld.strd.h) + bld.cld.h / 2 + bld.strd.h / 2;
                    col.position = ipnt.add(new BABYLON.Vector3(colRlx, colRly, colRlz));
                }

                bld.bxs.push(col);

                if (c < 4) {

                    switch (c) {
                        case 0:
                        case 1:
                            var walOpts = {
                                width: bld.strd.w - 1 / 8 * bld.cld.w,
                                depth: bld.cld.d / 8,
                                height: bld.cld.h,
                                sideOrientation: BABYLON.Mesh.DEFAULTSIDE
                            }
                            var wall = new BABYLON.MeshBuilder.CreateBox(j + ":" + i + "-W" + c, walOpts, scene);
                            wall.position = ipnt.add(new BABYLON.Vector3(0, colRly, clmx * (bld.strd.d / 2 - 0.125 * bld.cld.w)));

                            break;

                        case 2:
                        case 3:
                            var walOpts = {
                                width: bld.cld.d / 8,
                                depth: bld.strd.d - 1 / 8 * bld.cld.w,
                                height: bld.cld.h,
                                sideOrientation: BABYLON.Mesh.DEFAULTSIDE
                            }
                            var wall = new BABYLON.MeshBuilder.CreateBox(j + ":" + i + "-W" + c, walOpts, scene);
                            wall.position = ipnt.add(new BABYLON.Vector3(clmx * (bld.strd.w / 2 - 0.125 * bld.cld.w), colRly, 0));
                            break;

                        default:
                            break;
                    }
                    wallMat.alpha = 0.25;

                    wall.material = wallMat;

                    bld.bxs.push(wall);

                }
                ccntr++;
                if (ccntr > 3) {
                    ccntr = 0;
                }
            }

            var slbOpts = {
                width: bld.strd.w,
                height: bld.strd.h,
                depth: bld.strd.d,
                sideOrientation: BABYLON.Mesh.DEFAULTSIDE
            }
            var slb1 = slb.clone(j + ":" + i + "-S");
            dh = i * (bld.cld.h + bld.strd.h) + bld.cld.h + bld.strd.h;
            slb1.position = slb.position.add(new BABYLON.Vector3(0, dh, 0));
            bld.bxs.push(slb1);

        }
        bld.bxs.forEach((itm) => {
            itm.parent = bld.COT;
        });
        bld.COT.position = new BABYLON.Vector3(bld.loc.x, bld.loc.y, bld.loc.z)
    });

    /*  if (BABYLON.VideoRecorder.IsSupported(engine)) {
             var recorder = new BABYLON.VideoRecorder(engine);
             recorder.startRecording("test.webm", 64);
         } */
    scene.registerBeforeRender(() => {
        //bldgs[0].COT.rotation.y += 0.01;
        //bldgs[0].COT.position.y += 0.5;
        bldgs[1].COT.rotation.y += 0.1;
        if (camera.beta > PI / 2) {
            camera.beta = PI / 2;
        }

        //camera.alpha -= 0.01;


        if (this.outerWidth > this.outerHeight) {
            panel.isVertical = false;
            whr = this.outerWidth / this.outerHeight;
            cz = dvc;
            anchor.position.y = 5;
        } else {
            panel.isVertical = true;
            whr = this.outerHeight / this.outerWidth;
            cz = dvc;
            anchor.position.x = 0;

        }

        skyMaterial.inclination += 0.000255;
        //console.log(skyMaterial.inclination);
        if (skyMaterial.inclination > (0.4985 - 0.000255)) { skyMaterial.inclination = -0.4985 + 0.000255 * 0; }

        /* if (camera.beta >= PI / 2) { camera.beta = PI / 2; }
        if (camera.beta <= PI / 2.5) { camera.beta = PI / 2.5; } */

        /* if (camera.alpha >= 2 * 2.375 * PI / 2) { camera.alpha = 2 * 2.375 * PI / 2; }
        if (camera.alpha <= 0.55 * 2.375 * PI / 2) { camera.alpha = 0.55 * 2.375 * PI / 2; } */
        //  3 * PI / 2
        if (camera.radius <= cz) { camera.radius = cz; }
        if (camera.radius >= cz) { camera.radius = cz; }

        if (clk === -1) {
            panel.blockLayout = true;
            //panel._columns = 24;
            for (let key in e) {
                //console.log(mn[key].lbl);
                addButton(key, e[key]);
            }
            panel.blockLayout = false;
            //en.push(e);
            //mstxt.push(" ");
            enlen = en.length;
            //console.log(e, enlen, mstxt)
            clk = 0;
            //console.log(panel, clmns);

        }
        if (clk === 0) {

            /* if (fcs === 0) {
                camera.alpha = ca;
            } */

            //anchor.rotation.y+=0.0001;


        }
        if (clk === 1) {
            //console.log(stxt);
            panel.children.forEach(element => {
                element.dispose();
            });

            /*             if (orn === 1 && panel._columns !== 1) {
                            panel._columns = 1;
                            ca = -ca;
                            cz = -cz;
                        }
                        if (orn === 0 && panel._columns !== 26) {
                            panel._columns = 26;
                            ca = -ca;
                            cz = -cz;
                        } */

            if (stxt === "Back" && en.length > 0 && mstxt.length > 0) {
                mstxt.pop();
                var mtxt = mstxt[mstxt.length - 1];
                /*                         if (mtxt) {
                                            try {
                                                text0.text = "LV Projects\n" + mtxt.replace(/_/g, "\n");
                                            }
                                            catch {
                                                text0.text = "LV Projects\n" + mtxt;
                                            }
                                        } else {
                                            text0.text = "LV Projects\n" + "";
                                        } */
                en.pop();
                enlen = en.length - 1;
                if (en.length > 0) {
                    e = en[enlen][mtxt];
                }
                if (en.length === 0) {
                    e = mn;
                }
                if (panel.isVertical) {
                    anchor.position.y = 5;
                } else {
                    anchor.position.x = 0;
                }
                //console.log(e, enlen, mstxt);
            }
            if (stxt !== "Back") {
                mstxt.push(stxt);
                /*                         try {
                                            text0.text = "LV Projects\n" + stxt.replace(/_/g, "\n");
                                        }
                                        catch {
                                            text0.text = "LV Projects\n" + stxt;
                                        } */
                //text0.text = stxt;
                en.push(e);
                enlen = en.length - 1;
                e = en[enlen][stxt];
                if (panel.isVertical) {
                    anchor.position.y = 5;
                } else {
                    anchor.position.x = 0;
                }
                //console.log(en, enlen, mstxt)
            }
            clk = -1;
        }
        //console.log(clk);

        //clk = 0;




    });

    scene.defaultCursor = "grab";


    scene.onPointerObservable.add((pointerInfo) => {
        switch (pointerInfo.type) {
            case BABYLON.PointerEventTypes.POINTERDOWN:
                //text0.text = "POINTER DOWN";
                strt = [scene.pointerX, scene.pointerY];
                break;
            case BABYLON.PointerEventTypes.POINTERUP:
                /*                 crrt = [scene.pointerX, scene.pointerY];
                                dfrc = [crrt[0] - strt[0], crrt[1] - strt[1]];
                
                                if ((Math.abs(dfrc[0]) > Math.abs(dfrc[1])) && panel.isVertical === false) {
                                    //text0.text = "Horizontal";
                                    anchor.position.x += dfrc[0] / 1000 * whr;
                                }
                                if ((Math.abs(dfrc[0]) < Math.abs(dfrc[1])) && panel.isVertical === true) {
                                    //text0.text = "Vertical\n";
                                    //text0.text += dfrc[0] + "," + dfrc[1];
                                    anchor.position.y -= dfrc[1] / 1000 * whr;
                                } */
                strt = [];
                crrt = [];
                dfrc = [];
                //text0.text = dfrc[0] + "," + dfrc[1];
                //text0.text = "POINTER UP";
                break;
            case BABYLON.PointerEventTypes.POINTERMOVE:
                if (strt.length > 0) {
                    crrt = [scene.pointerX, scene.pointerY];
                    dfrc = [crrt[0] - strt[0], crrt[1] - strt[1]];

                    if ((Math.abs(dfrc[0]) > Math.abs(dfrc[1])) && panel.isVertical === false) {
                        //text0.text = "Horizontal";
                        anchor.position.x += dfrc[0] / 2000 * whr;
                        if (anchor.position.x > 0 + Object.keys(e).length / 2) {
                            anchor.position.x = 0 + Object.keys(e).length / 2;
                        }
                        if (anchor.position.x < 0 - Object.keys(e).length / 2) {
                            anchor.position.x = 0 - Object.keys(e).length / 2;
                        }
                    }
                    if ((Math.abs(dfrc[0]) < Math.abs(dfrc[1])) && panel.isVertical === true) {
                        //text0.text = "Vertical\n";
                        //text0.text += dfrc[0] + "," + dfrc[1];
                        anchor.position.y -= dfrc[1] / 2000 * whr;
                        if (anchor.position.y > 5 + Object.keys(e).length / 2) {
                            anchor.position.y = 5 + Object.keys(e).length / 2;
                        }
                        if (anchor.position.y < 5 - Object.keys(e).length / 2) {
                            anchor.position.y = 5 - Object.keys(e).length / 2;
                        }
                    }
                    //text0.text = "POINTER MOVES";
                    //text0.text = anchor.position.y;


                }
                break;
            case BABYLON.PointerEventTypes.POINTERWHEEL:
                if (panel.isVertical) {
                    // text0.text = "POINTER WHEEL";
                    // console.log(scene);
                }
                //text0.text = "POINTER WHEEL";
                break;
            case BABYLON.PointerEventTypes.POINTERPICK:
                //text0.text = "POINTER PICK";
                break;
            case BABYLON.PointerEventTypes.POINTERTAP:
                //text0.text = "POINTER TAP";
                break;
            case BABYLON.PointerEventTypes.POINTERDOUBLETAP:
                //text0.text = "POINTER DOUBLE-TAP";
                break;
        }
    })



    return scene;
};
createScene().then((scene) => {
    engine.runRenderLoop(function () {
        if (scene) {
            scene.render();
        }
    });
});


// Watch for browser/canvas resize events
window.addEventListener("resize", function () {
    engine.resize();

    /*       if (this.outerWidth > this.outerHeight) {
              orn = 0
          } else {
              orn = 1;
          } */

});




//})();